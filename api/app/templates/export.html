{% extends "base.html" %}
{% block content %}
<h1>Extract Coded Data</h1>

<div class="card">
  <form method="get" class="row">
    <label class="muted">Version</label>
    <select name="version">
      <option value="all" {% if version == "all" %}selected{% endif %}>All</option>
      <option value="v1" {% if version == "v1" %}selected{% endif %}>V1 (base 43)</option>
      <option value="ext" {% if version == "ext" %}selected{% endif %}>Extensions</option>
    </select>

    <label class="muted">Code (optional)</label>
    <select name="code" class="grow">
      <option value="">(any)</option>
      {% for c in codes %}
        <option value="{{ c.code }}" {% if code == c.code %}selected{% endif %}>{{ c.code }}</option>
      {% endfor %}
    </select>

    <label class="muted">Include annotators</label>
    <select name="include_annotators">
      <option value="" {% if not include_annotators %}selected{% endif %}>No</option>
      <option value="1" {% if include_annotators == "1" %}selected{% endif %}>Yes</option>
    </select>

    <label class="muted">Wide metric</label>
    <select name="metric">
      <option value="value" {% if metric == "value" %}selected{% endif %}>value</option>
      <option value="count" {% if metric == "count" %}selected{% endif %}>count</option>
      <option value="binary" {% if metric == "binary" %}selected{% endif %}>binary</option>
    </select>

    <button type="submit">Update</button>
  </form>
</div>

{% set inc = "true" if include_annotators == "1" else "false" %}

<div class="grid">
  <a class="bigbtn" href="/export/csv?project_id={{ project_id }}&version={{ version }}{% if code %}&code={{ code }}{% endif %}&include_annotators={{ inc }}">
    Download Long CSV (tidy)
  </a>

  <a class="bigbtn" href="/export/csv_wide?project_id={{ project_id }}&version={{ version }}{% if code %}&code={{ code }}{% endif %}&metric={{ metric }}">
    Download Wide CSV
  </a>
</div>

<div class="muted" style="margin-top:12px;">
  Long CSV = one row per (document, code). Wide CSV = one row per document with codes as columns.
</div>
{% endblock %}
